<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>رفع وتحويل الفيديو إلى لينك</title>
    
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/10.9.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.9.0/firebase-storage.js"></script>

    <style>
        body { font-family: Arial, sans-serif; text-align: center; margin: 50px; background: #f4f4f4; }
        .container { background: white; padding: 20px; border-radius: 10px; box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1); width: 50%; margin: auto; }
        .drop-area { border: 2px dashed #28a745; padding: 20px; cursor: pointer; background: #e9f7ef; margin-bottom: 10px; }
        .drop-area:hover { background: #d4edda; }
        input[type="file"] { display: none; }
        input, button { margin: 10px; padding: 10px; width: 80%; border: 1px solid #ddd; border-radius: 5px; }
        button { background-color: #28a745; color: white; cursor: pointer; }
        button:hover { background-color: #218838; }
        .progress-container { width: 80%; margin: 10px auto; background: #ddd; border-radius: 5px; overflow: hidden; }
        .progress-bar { width: 0%; height: 10px; background: #28a745; transition: width 0.3s; }
        .link-container { margin-top: 20px; display: none; }
        .copy-btn, .share-btn { background: #007bff; padding: 5px 10px; border: none; color: white; cursor: pointer; margin-left: 10px; }
        .copy-btn:hover, .share-btn:hover { background: #0056b3; }
        .success-message { color: #28a745; font-weight: bold; display: none; }
        .video-preview { width: 100%; max-width: 400px; margin-top: 10px; display: none; border-radius: 10px; }
    </style>
</head>
<body>

    <div class="container">
        <h2>رفع وتحويل الفيديو إلى لينك</h2>

        <!-- منطقة السحب والإفلات -->
        <div class="drop-area" onclick="document.getElementById('videoInput').click();">
            اسحب الفيديو هنا أو اضغط لاختياره
        </div>

        <input type="file" id="videoInput" accept="video/*">
        <input type="text" id="customName" placeholder="اختيار اسم اللينك (اختياري)"><br>
        <button onclick="uploadVideo()">رفع الفيديو</button>

        <!-- شريط التقدم -->
        <div class="progress-container">
            <div class="progress-bar" id="progressBar"></div>
        </div>

        <!-- عرض وقت الرفع المتوقع -->
        <p id="uploadTime" style="color: gray;"></p>

        <!-- عرض الفيديو بعد الرفع -->
        <video controls class="video-preview" id="videoPreview"></video>

        <!-- عرض اللينك بعد الرفع -->
        <div class="link-container" id="linkContainer">
            <p id="linkOutput"></p>
            <button class="copy-btn" onclick="copyLink()">نسخ اللينك</button>
            <button class="share-btn" onclick="shareLink()">مشاركة</button>
        </div>

        <!-- رسالة نجاح -->
        <p class="success-message" id="successMessage">✅ تم الرفع بنجاح!</p>
    </div>

    <script>
        // 🔥 بيانات Firebase (حط بيانات مشروعك هنا)
     // For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyB0Aj452H6Gp1ociH4ufHrLiU6Uucb-ysM",
  authDomain: "who-is-the-spy-51308.firebaseapp.com",
  databaseURL: "https://who-is-the-spy-51308-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "who-is-the-spy-51308",
  storageBucket: "who-is-the-spy-51308.firebasestorage.app",
  messagingSenderId: "900253646275",
  appId: "1:900253646275:web:b9f7a3cbb1069a07d2d176",
  measurementId: "G-NWXDDDRPRH"
};
        // 🔥 تهيئة Firebase
        firebase.initializeApp(firebaseConfig);
        const storage = firebase.storage();

        // دعم السحب والإفلات
        const dropArea = document.querySelector('.drop-area');
        dropArea.addEventListener('dragover', (e) => { e.preventDefault(); dropArea.style.background = "#d4edda"; });
        dropArea.addEventListener('dragleave', () => { dropArea.style.background = "#e9f7ef"; });
        dropArea.addEventListener('drop', (e) => {
            e.preventDefault();
            dropArea.style.background = "#e9f7ef";
            document.getElementById('videoInput').files = e.dataTransfer.files;
        });

        function uploadVideo() {
            const videoFile = document.getElementById('videoInput').files[0];
            const customName = document.getElementById('customName').value || videoFile.name.split('.')[0];

            if (!videoFile) {
                alert("❌ اختر فيديو أولًا!");
                return;
            }

            const storageRef = storage.ref(`videos/${customName}`);
            const uploadTask = storageRef.put(videoFile);
            const startTime = Date.now();

            uploadTask.on('state_changed',
                snapshot => {
                    const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                    document.getElementById('progressBar').style.width = progress + "%";

                    // حساب الوقت المتبقي
                    const elapsedTime = (Date.now() - startTime) / 1000;
                    const estimatedTime = (elapsedTime / (progress / 100)) - elapsedTime;
                    document.getElementById('uploadTime').innerText = `⏳ متبقي ${Math.ceil(estimatedTime)} ثانية`;
                },
                error => {
                    console.error("❌ خطأ:", error);
                    alert("⚠️ فشل الرفع! تأكد من إعدادات Firebase.");
                },
                () => {
                    uploadTask.snapshot.ref.getDownloadURL().then(downloadURL => {
                        document.getElementById('linkOutput').innerHTML = `<a href="${downloadURL}" target="_blank">${downloadURL}</a>`;
                        document.getElementById('linkContainer').style.display = "block";
                        document.getElementById('successMessage').style.display = "block";

                        // عرض الفيديو بعد الرفع
                        const videoPreview = document.getElementById('videoPreview');
                        videoPreview.src = downloadURL;
                        videoPreview.style.display = "block";
                    });
                }
            );
        }

        function copyLink() {
            const link = document.getElementById('linkOutput').textContent;
            navigator.clipboard.writeText(link).then(() => {
                alert("✅ تم نسخ اللينك!");
            }).catch(err => {
                console.error("❌ فشل النسخ:", err);
            });
        }

        function shareLink() {
            const link = document.getElementById('linkOutput').textContent;
            navigator.share ? navigator.share({ title: "رابط الفيديو", url: link }) : alert("🚀 المتصفح لا يدعم المشاركة التلقائية!");
        }
    </script>

</body>
</html>

