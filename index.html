<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UNO Online</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <style>
        :root {
            --primary: #E53935;
            --secondary: #1E88E5;
            --background: #f0f2f5;
            --card-width: 120px;
            --card-height: 180px;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', sans-serif;
        }

        body {
            background: var(--background);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 2rem;
        }

        .container {
            background: white;
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin: 1rem;
            transition: transform 0.3s ease;
            display: none;
        }

        .container.active {
            display: block;
            animation: slideIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes slideIn {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .game-container {
            display: none;
            position: relative;
            width: 100%;
            max-width: 1200px;
            min-height: 600px;
        }

        .card {
            width: var(--card-width);
            height: var(--card-height);
            border-radius: 12px;
            border: 2px solid white;
            position: absolute;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: bold;
            color: white;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
        }

        .card:hover {
            transform: translateY(-10px) scale(1.05);
            z-index: 100;
        }

        .discard-pile {
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
        }

        .player-hand {
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 1rem;
            padding: 1rem;
        }

        .rules-panel {
            position: fixed;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            width: 260px;
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        button {
            background: var(--primary);
            color: white;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        button:hover {
            filter: brightness(1.1);
            transform: translateY(-2px);
        }

        .room-code {
            font-size: 1.8rem;
            letter-spacing: 2px;
            background: #f0f0f0;
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
        }
    </style>
</head>
<body>
    <div class="container active" id="authContainer">
        <h1>UNO Online</h1>
        <div id="createRoomSection">
            <button onclick="createRoom()">Create New Room</button>
        </div>
        <div style="margin: 2rem 0; text-align: center;">OR</div>
        <div id="joinRoomSection">
            <input type="text" id="roomCodeInput" placeholder="Enter Room Code">
            <button onclick="joinRoom()">Join Room</button>
        </div>
    </div>

    <div class="container" id="lobbyContainer">
        <h2>Room Code: <span id="roomCodeDisplay" class="room-code"></span></h2>
        <div id="playersList" style="margin: 1rem 0;"></div>
        <button id="readyButton" onclick="toggleReady()" style="display: none;">Ready Up</button>
    </div>

    <div class="game-container" id="gameContainer">
        <div class="discard-pile" id="discardPile"></div>
        <div class="player-hand" id="playerHand"></div>
    </div>

    <div class="rules-panel">
        <h3>Game Rules</h3>
        <ul style="list-style: none; margin-top: 1rem;">
            <li>üéØ Match color or number</li>
            <li>üåà Wild cards change color</li>
            <li>‚ûï Draw cards force others to draw</li>
            <li>üîÑ Reverse changes turn order</li>
            <li>üö´ Skip skips next player</li>
            <li>üì¢ Say "UNO" when last card!</li>
        </ul>
    </div>

    <script>
        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyB0Aj452H6Gp1ociH4ufHrLiU6Uucb-ysM",
  authDomain: "who-is-the-spy-51308.firebaseapp.com",
  databaseURL: "https://who-is-the-spy-51308-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "who-is-the-spy-51308",
  storageBucket: "who-is-the-spy-51308.firebasestorage.app",
  messagingSenderId: "900253646275",
  appId: "1:900253646275:web:b9f7a3cbb1069a07d2d176",
  measurementId: "G-NWXDDDRPRH"
};

        const app = firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        let currentUser = null;
        let roomRef = null;
        let unsubscribeRoom = null;

        const colors = ['red', 'blue', 'green', 'yellow'];
        const specialCards = ['skip', 'reverse', 'draw2', 'wild', 'wild4'];

        class Game {
            constructor() {
                this.players = [];
                this.deck = [];
                this.discardPile = [];
                this.currentPlayerIndex = 0;
                this.direction = 1;
            }

            initializeDeck() {
                // Create full UNO deck
                colors.forEach(color => {
                    for (let i = 0; i <= 9; i++) {
                        this.deck.push({ color, value: i.toString() });
                        if (i !== 0) this.deck.push({ color, value: i.toString() });
                    }
                    specialCards.slice(0, 3).forEach(type => {
                        this.deck.push({ color, value: type });
                        this.deck.push({ color, value: type });
                    });
                });
                specialCards.slice(3).forEach(type => {
                    for (let i = 0; i < 4; i++) {
                        this.deck.push({ color: 'black', value: type });
                    }
                });
                this.shuffleDeck();
            }

            shuffleDeck() {
                for (let i = this.deck.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [this.deck[i], this.deck[j]] = [this.deck[j], this.deck[i]];
                }
            }

            dealCards(players) {
                players.forEach(player => {
                    player.hand = this.deck.splice(0, 7);
                });
                this.discardPile.push(this.deck.pop());
            }
        }

        auth.signInAnonymously().then(user => {
            currentUser = user;
        });

        async function createRoom() {
            const roomCode = generateRoomCode();
            roomRef = db.collection('rooms').doc(roomCode);
            
            await roomRef.set({
                players: [],
                gameState: 'waiting',
                currentGame: null,
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
            });

            joinRoom(roomCode, true);
        }

        async function joinRoom(roomCode, isHost = false) {
            const code = isHost ? roomCode : document.getElementById('roomCodeInput').value;
            roomRef = db.collection('rooms').doc(code);
            const doc = await roomRef.get();

            if (!doc.exists) return alert('Room not found');

            const playerRef = roomRef.collection('players').doc(currentUser.uid);
            await playerRef.set({
                uid: currentUser.uid,
                name: `Player ${Math.floor(Math.random() * 1000)}`,
                ready: false,
                hand: [],
                isHost
            });

            setupRoomListeners();
            showLobby(code);
        }

        function setupRoomListeners() {
            unsubscribeRoom = roomRef.onSnapshot(async doc => {
                const roomData = doc.data();
                updateLobbyUI(roomData);
                
                if (roomData.gameState === 'playing') {
                    startGame(roomData.currentGame);
                }
            });
        }

        function updateLobbyUI(roomData) {
            document.getElementById('roomCodeDisplay').textContent = roomRef.id;
            const playersList = document.getElementById('playersList');
            playersList.innerHTML = roomData.players.map(p => `
                <div>${p.name} ${p.ready ? '‚úÖ' : '‚ùå'}</div>
            `).join('');

            document.getElementById('readyButton').style.display = 
                roomData.players.length >= 2 ? 'block' : 'none';
        }

        async function toggleReady() {
            const playerRef = roomRef.collection('players').doc(currentUser.uid);
            const player = (await playerRef.get()).data();
            await playerRef.update({ ready: !player.ready });

            const allReady = (await roomRef.collection('players').get()).docs
                .every(p => p.data().ready);

            if (allReady) {
                const game = new Game();
                game.initializeDeck();
                game.dealCards(await getPlayers());
                await roomRef.update({
                    gameState: 'playing',
                    currentGame: game
                });
            }
        }

        function startGame(gameState) {
            document.getElementById('lobbyContainer').classList.remove('active');
            document.getElementById('gameContainer').style.display = 'block';
            renderGame(gameState);
        }

        function renderGame(game) {
            const hand = document.getElementById('playerHand');
            hand.innerHTML = game.players.find(p => p.uid === currentUser.uid)
                .hand.map(card => createCardElement(card)).join('');
        }

        function createCardElement(card) {
            return `<div class="card" style="background: ${card.color}">
                ${card.value}
            </div>`;
        }

        function generateRoomCode() {
            return Math.random().toString(36).substr(2, 6).toUpperCase();
        }

        function showLobby(code) {
            document.getElementById('authContainer').classList.remove('active');
            document.getElementById('lobbyContainer').classList.add('active');
        }

        // Initialize game
        document.getElementById('gameContainer').style.display = 'none';
    </script>
</body>
</html>
